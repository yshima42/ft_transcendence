generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id              String         @id @default(uuid())
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  name            String         @unique
  avatarUrl       String
  nickname        String         @unique @default("")
  onlineStatus    OnlineStatus   @default(ONLINE)
  matchedOpponent MatchResult[]  @relation("matchedOpponent")
  matchedUser     MatchResult[]  @relation("matchedUser")
  followedBy      Relationship[] @relation("followedBy")
  following       Relationship[] @relation("following")
}

model Relationship {
  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt
  userId    String
  peerId    String
  type      RelationshipType
  peer      User             @relation("followedBy", fields: [peerId], references: [id])
  user      User             @relation("following", fields: [userId], references: [id])

  @@id([userId, peerId])
}

model MatchResult {
  id            String   @id @default(uuid())
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  userId        String
  opponentId    String
  userScore     Int
  opponentScore Int
  win           Boolean
  opponent      User     @relation("matchedOpponent", fields: [opponentId], references: [id])
  user          User     @relation("matchedUser", fields: [userId], references: [id])
}

enum OnlineStatus {
  ONLINE
  OFFLINE
  INGAME
}

enum RelationshipType {
  FRIEND
  INCOMING
  OUTGOING
}
